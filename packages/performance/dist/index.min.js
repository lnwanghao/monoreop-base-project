!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self)["@whjs/performance"]={})}(this,function(e){"use strict";function n(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0}function t(){addEventListener("visibilitychange",T,!0),addEventListener("prerenderingchange",T,!0)}function B(a,c){c=c||{},w(y(function(){function e(e){e.forEach(function(e){var n,t;e.hadRecentInput||(n=r[0],t=r[r.length-1],i&&e.startTime-t.startTime<1e3&&e.startTime-n.startTime<5e3?(i+=e.value,r.push(e)):(i=e.value,r=[e]))}),i>t.value&&(t.value=i,t.entries=r,n())}var n,t=m("CLS",0),i=0,r=[],o=l("layout-shift",e);o&&(n=v(a,t,L,c.reportAllChanges),g(function(){e(o.takeRecords()),n(!0)}),d(function(){t=m("CLS",i=0),n=v(a,t,L,c.reportAllChanges),h(function(){return n()})}),setTimeout(n,0))}))}function c(e,n){u||(u=n,f=e,i=new Date,P(removeEventListener),A())}function H(a,c){c=c||{},S(function(){function e(e){e.forEach(i)}var n=E(),t=m("FID"),i=function(e){e.startTime<n.firstHiddenTime&&(t.value=e.processingStart-e.startTime,t.entries.push(e),o(!0))},r=l("first-input",e),o=v(a,t,F,c.reportAllChanges);r&&g(y(function(){e(r.takeRecords()),r.disconnect()})),r&&d(function(){var e;t=m("FID"),o=v(a,t,F,c.reportAllChanges),s=[],f=-1,u=null,P(addEventListener),e=i,s.push(e),A()})})}function I(a,c){c=c||{},S(function(){function e(e){(e=e[e.length-1])&&e.startTime<i.firstHiddenTime&&(r.value=Math.max(e.startTime-p(),0),r.entries=[e],n())}var n,t,i=E(),r=m("LCP"),o=l("largest-contentful-paint",e);o&&(n=v(a,r,O,c.reportAllChanges),t=y(function(){D[r.id]||(e(o.takeRecords()),o.disconnect(),D[r.id]=!0,n(!0))}),["keydown","click"].forEach(function(e){addEventListener(e,t,!0)}),g(t),d(function(e){r=m("LCP"),n=v(a,r,O,c.reportAllChanges),h(function(){r.value=performance.now()-e.timeStamp,D[r.id]=!0,n(!0)})}))})}var u,f,i,s,r=-1,d=function(n){addEventListener("pageshow",function(e){e.persisted&&(r=e.timeStamp,n(e))},!0)},a=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},p=function(){var e=a();return e&&e.activationStart||0},m=function(e,n){var t=a(),i="navigate";return 0<=r?i="back-forward-cache":t&&(i=document.prerendering||0<p()?"prerender":document.wasDiscarded?"restore":t.type.replace(/_/g,"-")),{name:e,value:void 0===n?-1:n,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},l=function(e,n,t){try{var i;if(PerformanceObserver.supportedEntryTypes.includes(e))return(i=new PerformanceObserver(function(e){Promise.resolve().then(function(){n(e.getEntries())})})).observe(Object.assign({type:e,buffered:!0},t||{})),i}catch(e){}},v=function(n,t,i,r){var o,a;return function(e){0<=t.value&&(e||r)&&((a=t.value-(o||0))||void 0===o)&&(o=t.value,t.delta=a,t.rating=(e=t.value)>i[1]?"poor":e>i[0]?"needs-improvement":"good",n(t))}},h=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},g=function(n){function e(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||n(e)}addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0)},y=function(n){var t=!1;return function(e){t||(n(e),t=!0)}},o=-1,T=function(e){"hidden"===document.visibilityState&&-1<o&&(o="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("visibilitychange",T,!0),removeEventListener("prerenderingchange",T,!0))},E=function(){return o<0&&(o=n(),t(),d(function(){setTimeout(function(){o=n(),t()},0)})),{get firstHiddenTime(){return o}}},S=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},b=[1800,3e3],w=function(o,a){a=a||{},S(function(){var n,t=E(),i=m("FCP"),r=l("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(r.disconnect(),e.startTime<t.firstHiddenTime)&&(i.value=Math.max(e.startTime-p(),0),i.entries.push(e),n(!0))})});r&&(n=v(o,i,b,a.reportAllChanges),d(function(e){i=m("FCP"),n=v(o,i,b,a.reportAllChanges),h(function(){i.value=performance.now()-e.timeStamp,n(!0)})}))})},L=[.1,.25],C={passive:!0,capture:!0},j=new Date,A=function(){var n;0<=f&&f<i-j&&(n={entryType:"first-input",name:u.type,target:u.target,cancelable:u.cancelable,startTime:u.timeStamp,processingStart:u.timeStamp+f},s.forEach(function(e){e(n)}),s=[])},q=function(e){var n,t,i,r;function o(){c(t,i),r()}function a(){r()}e.cancelable&&(n=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(t=n,i=e,r=function(){removeEventListener("pointerup",o,C),removeEventListener("pointercancel",a,C)},addEventListener("pointerup",o,C),addEventListener("pointercancel",a,C)):c(n,e))},P=function(n){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return n(e,q,C)})},F=[100,300],O=[2500,4e3],D={},R=[800,1800],z=function e(n){document.prerendering?S(function(){return e(n)}):"complete"!==document.readyState?addEventListener("load",function(){return e(n)},!0):setTimeout(n,0)};var _,M,x,N=window,J=0,K=!1,k=[],W=N.innerWidth,Y=N.innerHeight;function G(e){cancelAnimationFrame(_),_=requestAnimationFrame(function(){var n;(K="complete"===document.readyState?!0:K)?(null!=M&&M.disconnect(),n=0,k.forEach(function(e){e.startTime>n&&(n=e.startTime)}),J=n-performance.timeOrigin,k=[],e&&e(J)):G(e)})}function Q(e){e=e.getBoundingClientRect();return e.left<W&&e.top<Y}function U(n){var t,i,r,o,u,f;I(function(e){n(e)}),H(function(e){n(e)}),B(function(e){n(e)}),w(function(e){n(e)}),t=function(e){n(e)},i=i||{},r=m("TTFB"),o=v(t,r,R,i.reportAllChanges),z(function(){var e,n=a();!n||(e=n.responseStart)<=0||e>performance.now()||(r.value=Math.max(e-p(),0),r.entries=[n],o(!0),d(function(){r=m("TTFB",0),(o=v(t,r,R,i.reportAllChanges))(!0)}))}),u=function(e){n({name:"FSP",value:e,rating:2500<e?"poor":"good"})},f=["STYLE","SCRIPT","LINK"],(M=new MutationObserver(function(e){G(u);for(var n={children:[],startTime:0},t=0,i=e;t<i.length;t++){var r=i[t];if(r.addedNodes.length&&Q(r.target))for(var o=0,a=r.addedNodes;o<a.length;o++){var c=a[o];1===c.nodeType&&!f.includes(c.tagName)&&Q(c)&&n.children.push(c)}}n.children.length&&(k.push(n),n.startTime=(new Date).getTime())})).observe(document,{childList:!0,subtree:!0,characterData:!0,attributes:!0})}function V(){this.type=x.PERFORMANCE}(x=x||{}).PERFORMANCE="performance",V.prototype.getPerformanceDetail=function(n){var e,t,i;U(function(e){n(e)}),e="load",t=function(){var e;(e=performance.getEntriesByType("resource").filter(function(e){return-1===["fetch","xmlhttprequest","beacon"].indexOf(e.initiatorType)})).length&&(e=JSON.parse(JSON.stringify(e))).forEach(function(e){e.isCache=0===(e=e).transferSize||0!==e.transferSize&&0===e.encodedBodySize}),n({name:"resoure",value:e})},N.addEventListener(e,t,i=void 0===i?!1:i)};var X=new V;e.webPerformance=X,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
